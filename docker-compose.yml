version: '3.5'
services:
  r360-frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    command: bash -c "npm install && npm run dev"
    env_file:
      - ./frontend/.env
    volumes:
      - ./frontend:/app
    ports:
      - "3000:3000"
    networks:
      - external_network
      - default

  r360-backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    env_file:
      - ./backend/.env.dist
    volumes:
      - ./backend:/var/www
      - ./backend/.docker/nginx/logs:/etc/logs/nginx
      - ./backend/.docker/php/log:/var/log
    ports:
      - 8181:80
    networks:
      - external_network

  r360-mongodb:
    image: mongo:4.1.7
    volumes:
      - ./backend/.docker/mongodb/data:/data/db
    environment:
      - MONGO_INITDB_DATABASE=r360
    expose:
      - 27017
    networks:
      - external_network

networks:
  external_network:
